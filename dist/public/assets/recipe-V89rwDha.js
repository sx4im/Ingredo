import{j as e,H as ae,D as te,J as re,r as P,v as L,w as ie,x as A,K as ne,o as le,N as F,O as ce,Q as oe,V as M,s as T,W as de,Y as me,Z as xe,_ as he}from"./ui-BzyooJSI.js";import{f as ue,a as c}from"./vendor-BfRVl83A.js";import{b as D,u as H}from"./query-CozCGnLG.js";import{a as v}from"./apiClient-BAYgEl2O.js";import{u as ge,C as o,b as d,B as r,n as p,o as j}from"./index-9SW5wrSE.js";import{B as pe}from"./badge-DhJbbhe2.js";import{S as f}from"./separator-BFvmEZt_.js";import{S as w}from"./skeleton-C865a2-8.js";import{I as je}from"./input-1gfFfBuy.js";import{C as fe}from"./checkbox-FnWL6ikr.js";import{D as Ne,a as be,b as ve,c as we}from"./dialog-C3pEOE3v.js";import"./index-D2KtrdjK.js";function Me(){const k=ue().slug,{toast:u}=ge(),[m,R]=c.useState(4),[g,N]=c.useState(new Set),[x,b]=c.useState(new Set),[i,h]=c.useState(null),[O,z]=c.useState(!1),[U,_]=c.useState({}),{data:a,isLoading:q,error:B}=D({queryKey:["recipe",k],queryFn:()=>v.get(`/api/recipe/${k}`).then(s=>s.data),enabled:!!k}),{data:y}=D({queryKey:["similar-recipes",a?.id],queryFn:()=>v.get(`/api/recipe/${a?.id}/similar`).then(s=>s.data),enabled:!!a?.id}),E=H({mutationFn:s=>v.post(`/api/recipe/${s}/save`),onSuccess:()=>{u({title:"Recipe saved!",description:"Added to your favorites."})}}),I=H({mutationFn:({recipeId:s,type:t,itemId:n})=>v.post(`/api/recipe/${s}/progress`,{type:t,itemId:n})});c.useEffect(()=>{let s;return i?.isRunning&&i.timeLeft>0?s=setInterval(()=>{h(t=>t?{...t,timeLeft:t.timeLeft-1}:null)},1e3):i?.timeLeft===0&&(u({title:"Timer finished!",description:`Step ${i.stepNumber} is complete.`}),h(null)),()=>clearInterval(s)},[i,u]),c.useEffect(()=>{if(a){const s=localStorage.getItem(`recipe-progress-${a.id}`);if(s){const{ingredients:t,steps:n,servings:l}=JSON.parse(s);N(new Set(t)),b(new Set(n)),R(l)}}},[a]);const C=c.useCallback((s,t,n)=>{if(a){const l={ingredients:Array.from(s),steps:Array.from(t),servings:n};localStorage.setItem(`recipe-progress-${a.id}`,JSON.stringify(l))}},[a]),J=s=>{const t=new Set(g);t.has(s)?t.delete(s):t.add(s),N(t),C(t,x,m),a&&I.mutate({recipeId:a.id,type:"ingredient",itemId:s})},K=s=>{const t=new Set(x);t.has(s)?t.delete(s):t.add(s),b(t),C(g,t,m),a&&I.mutate({recipeId:a.id,type:"step",itemId:s})},$=s=>{s>0&&(R(s),C(g,x,s))},Q=s=>a?Math.round(s*m/a.servings*100)/100:s,V=(s,t)=>{h({isRunning:!0,timeLeft:t*60,totalTime:t*60,stepNumber:s})},W=()=>{h(s=>s?{...s,isRunning:!1}:null)},Y=()=>{h(s=>s?{...s,isRunning:!0}:null)},Z=()=>{h(null)},G=s=>{const t=Math.floor(s/60),n=s%60;return`${t}:${n.toString().padStart(2,"0")}`},X=()=>{navigator.clipboard.writeText(window.location.href),u({title:"Link copied!",description:"Recipe link copied to clipboard."})},S=s=>{const t=encodeURIComponent(window.location.href),n=encodeURIComponent(a?.title||"");let l="";switch(s){case"facebook":l=`https://www.facebook.com/sharer/sharer.php?u=${t}`;break;case"twitter":l=`https://twitter.com/intent/tweet?url=${t}&text=${n}`;break;case"instagram":l="https://www.instagram.com/";break}l&&window.open(l,"_blank","width=600,height=400")},ee=()=>{window.print()},se=(s,t)=>{_(n=>({...n,[s]:t})),u({title:"Substitution applied!",description:`Using ${t} instead.`})};return q?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 z-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(/recipe.webp)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),e.jsx("div",{className:"fixed inset-0 z-0",style:{backgroundColor:"rgba(30, 64, 175, 0.8)"}}),e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsx(w,{className:"h-64 w-full rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{className:"h-8 w-3/4"}),e.jsx(w,{className:"h-4 w-full"}),e.jsx(w,{className:"h-4 w-2/3"})]})]})})]}):B||!a?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed inset-0 z-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(/recipe.webp)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),e.jsx("div",{className:"fixed inset-0 z-0",style:{backgroundColor:"rgba(30, 64, 175, 0.8)"}}),e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:e.jsx(o,{className:"max-w-md mx-auto",children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2 text-foreground",children:"Recipe not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The recipe you're looking for doesn't exist or has been removed."})]})})})]}):e.jsxs("div",{className:"relative min-h-screen bg-grain bg-background font-sans text-foreground py-12",children:[e.jsx("div",{className:"container mx-auto px-6 lg:px-12 relative z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[a.image&&e.jsxs("div",{className:"relative mb-6",children:[e.jsx("img",{src:a.image,alt:a.title,className:"w-full h-64 md:h-80 object-cover rounded-lg"}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>E.mutate(a.id),"data-testid":"save-recipe",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Save"]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>z(!0),"data-testid":"share-recipe",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Share"]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:ee,"data-testid":"print-recipe",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Print"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:a.tags.map(s=>e.jsx(pe,{variant:"secondary",className:"bg-vintage-warm-brown/20 text-foreground",children:s},s))}),e.jsx("h1",{className:"font-serif text-3xl md:text-4xl font-medium text-foreground",children:a.title}),e.jsx("p",{className:"text-lg text-muted-foreground",children:a.description}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-vintage-warm-brown/20 flex items-center justify-center",children:e.jsx(P,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:a.author.name}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Recipe Author"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.prepTime+a.cookTime," mins total"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs("span",{children:[m," servings"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:a.difficulty})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4 text-yellow-400 fill-current"}),e.jsxs("span",{children:[a.rating," (",a.reviewCount," reviews)"]})]})]})]})]}),e.jsx(o,{className:"mb-8 bg-vintage-light-beige/10 backdrop-blur-sm border-vintage-warm-brown/20",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.prepTime}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Prep Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.cookTime}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cook Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.prepTime+a.cookTime}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(r,{size:"sm",variant:"outline",onClick:()=>$(m-1),disabled:m<=1,className:"h-8 w-8 p-0",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-2xl font-bold text-foreground min-w-[3rem]",children:m}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>$(m+1),className:"h-8 w-8 p-0",children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Servings"})]})]})})}),i&&e.jsx(o,{className:"mb-8 bg-vintage-warm-brown/20 backdrop-blur-sm border-vintage-warm-brown/40",children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-6 w-6 text-foreground"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-foreground",children:["Step ",i.stepNumber," Timer"]}),e.jsx("div",{className:"text-2xl font-mono text-foreground",children:G(i.timeLeft)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[i.isRunning?e.jsxs(r,{size:"sm",onClick:W,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Pause"]}):e.jsxs(r,{size:"sm",onClick:Y,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Resume"]}),e.jsxs(r,{size:"sm",variant:"outline",onClick:Z,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Stop"]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-vintage-warm-brown h-2 rounded-full transition-all duration-1000",style:{width:`${(i.totalTime-i.timeLeft)/i.totalTime*100}%`}})})})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(o,{className:"bg-vintage-light-beige/10 backdrop-blur-sm border-vintage-warm-brown/20",children:[e.jsx(p,{children:e.jsx(j,{className:"text-foreground",children:"Ingredients"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:a.ingredients.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-vintage-warm-brown/10 transition-colors",children:[e.jsx(fe,{id:s.id,checked:g.has(s.id),onCheckedChange:()=>J(s.id),className:"data-[state=checked]:bg-vintage-warm-brown data-[state=checked]:border-vintage-warm-brown"}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[s.thumbnail&&e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-8 h-8 rounded object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:`font-medium ${g.has(s.id)?"line-through text-muted-foreground/60":"text-foreground"}`,children:U[s.id]||s.name}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:[Q(s.amount)," ",s.unit]})]})]}),s.substitutes&&s.substitutes.length>0&&e.jsx("div",{className:"flex gap-1",children:s.substitutes.slice(0,2).map((t,n)=>e.jsx(r,{size:"sm",variant:"outline",onClick:()=>se(s.id,t.name),className:"text-xs h-7",children:t.name},n))})]},s.id))})})]}),e.jsxs(o,{className:"bg-vintage-light-beige/10 backdrop-blur-sm border-vintage-warm-brown/20",children:[e.jsx(p,{children:e.jsx(j,{className:"text-foreground",children:"Instructions"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-6",children:a.instructions.map(s=>e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{onClick:()=>K(s.step),className:`flex-shrink-0 w-10 h-10 rounded-full border-2 flex items-center justify-center transition-colors ${x.has(s.step)?"bg-vintage-warm-brown border-vintage-warm-brown text-foreground":"border-vintage-light-beige/30 hover:border-vintage-warm-brown text-foreground"}`,"data-testid":`step-${s.step}`,children:x.has(s.step)?e.jsx(T,{className:"h-5 w-5"}):e.jsx("span",{className:"text-sm font-medium",children:s.step})}),s.time_min&&e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>V(s.step,s.time_min),className:"mt-2 text-xs h-6",disabled:!!i,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),s.time_min,"m"]})]}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:`text-foreground leading-relaxed ${x.has(s.step)?"line-through text-muted-foreground/60":""}`,children:s.description})})]},s.step))})})]})]}),e.jsxs("div",{className:"space-y-6",children:[a.nutrition&&e.jsxs(o,{className:"bg-vintage-light-beige/10 backdrop-blur-sm border-vintage-warm-brown/20",children:[e.jsx(p,{children:e.jsx(j,{className:"text-foreground text-lg",children:"Nutrition (per serving)"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories"}),e.jsx("span",{className:"text-foreground font-medium",children:a.nutrition.calories})]}),e.jsx(f,{className:"bg-vintage-warm-brown/20"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein"}),e.jsx("span",{className:"text-foreground font-medium",children:a.nutrition.protein})]}),e.jsx(f,{className:"bg-vintage-warm-brown/20"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs"}),e.jsx("span",{className:"text-foreground font-medium",children:a.nutrition.carbs})]}),e.jsx(f,{className:"bg-vintage-warm-brown/20"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat"}),e.jsx("span",{className:"text-foreground font-medium",children:a.nutrition.fat})]}),e.jsx(f,{className:"bg-vintage-warm-brown/20"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fiber"}),e.jsx("span",{className:"text-foreground font-medium",children:a.nutrition.fiber})]}),e.jsx(f,{className:"bg-vintage-warm-brown/20"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Sugar"}),e.jsx("span",{className:"text-foreground font-medium",children:a.nutrition.sugar})]})]})]}),e.jsxs(o,{className:"bg-vintage-light-beige/10 backdrop-blur-sm border-vintage-warm-brown/20",children:[e.jsx(p,{children:e.jsx(j,{className:"text-foreground text-lg",children:"Quick Actions"})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs(r,{className:"w-full justify-start",variant:"outline",onClick:()=>N(new Set(a.ingredients.map(s=>s.id))),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Check All Ingredients"]}),e.jsxs(r,{className:"w-full justify-start",variant:"outline",onClick:()=>b(new Set(a.instructions.map(s=>s.step))),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Complete All Steps"]}),e.jsxs(r,{className:"w-full justify-start",variant:"outline",onClick:()=>{N(new Set),b(new Set)},children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Reset Progress"]})]})]})]})]}),y&&y.length>0&&e.jsxs(o,{className:"mt-12 bg-vintage-light-beige/10 backdrop-blur-sm border-vintage-warm-brown/20",children:[e.jsx(p,{children:e.jsx(j,{className:"text-foreground",children:"Similar Recipes"})}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map(s=>e.jsx(o,{className:"bg-vintage-warm-brown/10 border-vintage-warm-brown/20 hover:bg-vintage-warm-brown/20 transition-colors",children:e.jsxs(d,{className:"p-4",children:[s.image&&e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-32 object-cover rounded mb-3"}),e.jsx("h3",{className:"font-medium text-foreground mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),s.cookTime,"m"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3 text-yellow-400 fill-current"}),s.rating]})]})]})},s.id))})})]})]})}),e.jsx(Ne,{open:O,onOpenChange:z,children:e.jsxs(be,{className:"bg-vintage-light-beige border-vintage-warm-brown/20",children:[e.jsx(ve,{children:e.jsx(we,{className:"text-primary",children:"Share Recipe"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{value:window.location.href,readOnly:!0,className:"flex-1"}),e.jsxs(r,{onClick:X,variant:"outline",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:()=>S("facebook"),variant:"outline",className:"flex-1",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Facebook"]}),e.jsxs(r,{onClick:()=>S("twitter"),variant:"outline",className:"flex-1",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Twitter"]}),e.jsxs(r,{onClick:()=>S("instagram"),variant:"outline",className:"flex-1",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Instagram"]})]})]})]})})]})}export{Me as default};
